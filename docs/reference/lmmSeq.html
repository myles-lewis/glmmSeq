<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Linear mixed models for data matrix — lmmSeq • glmmSeq</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Linear mixed models for data matrix — lmmSeq" />
<meta property="og:description" content="Fits many linear mixed effects models for analysis of gaussian data with
random effects, with parallelisation and optimisation for speed. It is
suitable for longitudinal analysis of high dimensional data. Wald type 2
Chi-squared test is used to calculate p-values." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glmmSeq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/glmmSeq.html">
    <span class="fas fa-book"></span>
     
    Get Started
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper"></span>
     
    News
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="far fa-file-code"></span>
     
    Reference Manual
  </a>
</li>
<li>
  <a href="https://github.com/KatrionaGoldmann/glmmSeq">
    <span class="fab fa-github"></span>
     
    Github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Linear mixed models for data matrix</h1>
    <small class="dont-index">Source: <a href='https://github.com/KatrionaGoldmann/glmmSeq/blob/master/R/lmmSeq.R'><code>R/lmmSeq.R</code></a></small>
    <div class="hidden name"><code>lmmSeq.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits many linear mixed effects models for analysis of gaussian data with
random effects, with parallelisation and optimisation for speed. It is
suitable for longitudinal analysis of high dimensional data. Wald type 2
Chi-squared test is used to calculate p-values.</p>
    </div>

    <pre class="usage"><span class='fu'>lmmSeq</span><span class='op'>(</span>
  <span class='va'>modelFormula</span>,
  <span class='va'>maindata</span>,
  <span class='va'>metadata</span>,
  id <span class='op'>=</span> <span class='cn'>NULL</span>,
  offset <span class='op'>=</span> <span class='cn'>NULL</span>,
  test.stat <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Wald"</span>, <span class='st'>"F"</span>, <span class='st'>"LRT"</span><span class='op'>)</span>,
  reduced <span class='op'>=</span> <span class='cn'>NULL</span>,
  modelData <span class='op'>=</span> <span class='cn'>NULL</span>,
  designMatrix <span class='op'>=</span> <span class='cn'>NULL</span>,
  control <span class='op'>=</span> <span class='fu'>lmerControl</span><span class='op'>(</span><span class='op'>)</span>,
  cores <span class='op'>=</span> <span class='fl'>1</span>,
  removeSingles <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  returnList <span class='op'>=</span> <span class='cn'>FALSE</span>,
  progress <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>modelFormula</th>
      <td><p>the model formula. This must be of the form <code>"~ ..."</code>
where the structure is assumed to be <code>"gene ~ ..."</code>. The formula must
include a random effects term. See formula structure for random effects in
<code><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lme4::lmer()</a></code></p></td>
    </tr>
    <tr>
      <th>maindata</th>
      <td><p>data matrix with genes in rows and samples in columns</p></td>
    </tr>
    <tr>
      <th>metadata</th>
      <td><p>a dataframe of sample information with variables in columns
and samples in rows</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>Optional. Used to specify the column in metadata which contains the
sample IDs to be used in repeated samples for random effects. If not
specified, the function defaults to using the variable after the "|" in the
random effects term in the formula.</p></td>
    </tr>
    <tr>
      <th>offset</th>
      <td><p>Vector containing model offsets (default = NULL). If provided
the <code>lmer()</code> offset is set to <code>offset</code>. See
<code><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lme4::lmer()</a></code></p></td>
    </tr>
    <tr>
      <th>test.stat</th>
      <td><p>Character value specifying test statistic. Current options
are "Wald" for type 2 Wald Chi square test using code derived and modified
from <a href='https://rdrr.io/pkg/car/man/Anova.html'>car::Anova</a> to improve speed for matrix tests. Or "F" for conditional
F tests using Saiterthwaite's method of approximated Df. This uses
<a href='https://rdrr.io/pkg/lmerTest/man/lmer.html'>lmerTest::lmer</a> and is somewhat slower.</p></td>
    </tr>
    <tr>
      <th>reduced</th>
      <td><p>Optional reduced model formula. If this is chosen, a
likelihood ratio test is used to calculate p-values instead of the default
Wald type 2 Chi-squared test.</p></td>
    </tr>
    <tr>
      <th>modelData</th>
      <td><p>Optional dataframe. Default is generated by call to
<code>expand.grid</code> using levels of variables in the formula. Used to calculate
model predictions (estimated means &amp; 95% CI) for plotting via <a href='modelPlot.html'>modelPlot</a>.
It can therefore be used to add/remove points in <a href='modelPlot.html'>modelPlot</a>.</p></td>
    </tr>
    <tr>
      <th>designMatrix</th>
      <td><p>Optional custom design matrix generated by call to
<code>model.matrix</code> using <code>modelData</code> and <code>FEformula</code>. Used to calculate
model predictions for plotting.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>the <code>lmer</code> optimizer control (default = <code>lmerControl()</code>). See
<code><a href='https://rdrr.io/pkg/lme4/man/lmerControl.html'>lme4::lmerControl()</a></code>.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>number of cores to use for parallelisation. Default = 1.</p></td>
    </tr>
    <tr>
      <th>removeSingles</th>
      <td><p>whether to remove individuals with no repeated measures
(default = FALSE)</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical whether to display messaging (default = TRUE)</p></td>
    </tr>
    <tr>
      <th>returnList</th>
      <td><p>Logical whether to return results as a list or lmmSeq
object (default = FALSE). Helpful for debugging.</p></td>
    </tr>
    <tr>
      <th>progress</th>
      <td><p>Logical whether to display a progress bar</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other parameters passed to
<code><a href='https://rdrr.io/pkg/lmerTest/man/lmer.html'>lmerTest::lmer()</a></code>. Only available if
<code>test.stat = "F"</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns an S4 class <code>lmmSeq</code> object with results for gene-wise
linear mixed models; or a list of results if <code>returnList</code> is <code>TRUE</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>By default, p-values for each model term are computed using Wald type 2
Chi-squared test as per <code><a href='https://rdrr.io/pkg/car/man/Anova.html'>car::Anova()</a></code>. The underlying code for this has been
optimised for speed. However, if a reduced model formula is specified by
setting <code>reduced</code>, then a likelihood ratio test (LRT) is performed instead
using <code><a href='https://rdrr.io/pkg/lme4/man/merMod-class.html'>anova</a></code>. This will double computation
time since two LMM have to be fitted for each gene. For LRT, models being
compared are optimised by maximum likelihood and not REML (<code>REML=FALSE</code>).</p>
<p>Two key methods are used to speed up computation above and beyond simple
parallelisation. The first is to speed up <code><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lme4::lmer()</a></code> by calling
<code><a href='https://rdrr.io/pkg/lme4/man/modular.html'>lme4::lFormula()</a></code> once at the start and then updating the <code>lFormula</code> output
with new data. The 2nd speed up is through optimised code for repeated type 2
Wald Chi-squared tests (original code was derived from <a href='https://rdrr.io/pkg/car/man/Anova.html'>car::Anova</a>). For
example, elements such as the hypothesis matrices are generated only once to
reduce unnecessarily repetitive computation, and the generation of p-values
from Chi-squared values is vectorised and performed at the end. F-tests using
the <code>lmerTest</code> package have not been optimised and are therefore slower.</p>
<p>Parallelisation is performed using <a href='https://rdrr.io/r/parallel/mclapply.html'>parallel::mclapply</a> on unix/mac and
<a href='https://rdrr.io/r/parallel/clusterApply.html'>parallel::parLapply</a> on windows. Progress bars use <a href='https://rdrr.io/pkg/pbmcapply/man/pbmclapply.html'>pbmcapply::pbmclapply</a>
on unix/mac and <a href='https://rdrr.io/pkg/pbapply/man/pbapply.html'>pbapply::pblapply</a> on windows.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>PEAC_minimal_load</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>logtpm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log2</a></span><span class='op'>(</span><span class='va'>tpm</span> <span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>lmmtest</span> <span class='op'>&lt;-</span> <span class='fu'>lmmSeq</span><span class='op'>(</span><span class='op'>~</span> <span class='va'>Timepoint</span> <span class='op'>*</span> <span class='va'>EULAR_6m</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>PATID</span><span class='op'>)</span>,</span>
<span class='r-in'>                     maindata <span class='op'>=</span> <span class='va'>logtpm</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, <span class='op'>]</span>,</span>
<span class='r-in'>                     metadata <span class='op'>=</span> <span class='va'>metadata</span>,</span>
<span class='r-in'>                     verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>lmmtest</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>  [1] "info"      "formula"   "stats"     "predict"   "reduced"   "maindata" </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>  [7] "metadata"  "modelData" "optInfo"   "errors"    "vars"      "class"    </span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">

<style>
  #left {
    float:left;
  }
  #right {
    width:100%;
    position:relative;
    text-align:right;
    align:right;
    float:right;
  }
  *.icon-grey {color: lightgrey}
  j {
    text-align:center;
    vertical-align:middle;
    position: relative;
    padding-bottom: 12px;
  }
  .smadge:after{
    content:"EMR";
    position: absolute;
    background: lightgrey;
    height:1.2rem;
    top:1rem;
    right:-1rem;
    width:2.3rem;
    text-align: center;
    line-height: 1rem;;
    font-size: 1rem;
    color: #ff3333;
    border-radius: 10%;
  }
  .bladge:after{
    content:"C4TB";
    position: absolute;
    background: lightgrey;
    height:1.2rem;
    top:1rem;
    right:-1rem;
    width:2.7rem;
    text-align: center;
    line-height: 1rem;;
    font-size: 1rem;
    color: #ff3333;
    border-radius: 10%;
  }
</style>

<div id="left">
Developed by the <a href="https://www.qmul.ac.uk/whri/emr/">Centre for Experimental Medicine & Rheumatology</a>, QMUL
</div>

<div id="right">
<a href="https://www.qmul.ac.uk/whri/emr/"><j class="fa fa-university fa-2x  icon-grey smadge" aria-hidden="false" style="color:#ff3333"></j></a>
<span style="margin-left:1rem"></span>

<a href="https://www.qmul.ac.uk/c4tb/"><j class="fa fa-university fa-2x  icon-grey bladge" aria-hidden="false" style="color:#ff3333"></j></a>
<span style="margin-left:1rem"></span>

<a href="mailto:k.goldmann@qmul.ac.uk" class="fas fa-envelope fa-2x" style="color:#ff3333">
</a><span style="margin-left:1rem"></span>

<a href="https://github.com/KatrionaGoldmann"><i class="fab fa-github fa-2x" style="color:#ff3333"></i></a>
<span style="margin-left:1rem"></span>

<a href="https://twitter.com/EMR_QMUL"><i class="fab fa-twitter fa-2x" style="color:#ff3333"></i></a>
</div>

      </footer>
   </div>

  


  </body>
</html>


